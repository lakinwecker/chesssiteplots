import requests
import time
from tqdm import tqdm
import json
import pandas as pd
import pickle

''' # for downloading the data
#https://api.chess.com/pub/titled/GM
gms = ["123lt","124chess","1977ivan","1stsecond","4thd-alpeacefulmoon","64aramis64","64arthos64","64atilla64","64dartagnan64","64genghis64","64leonidas64","64porthos64","64pyrrhus64","731291","a-adly","a-fier","abasovn","abhidabhi","abhijeetgupta","abhijeetgupta1016","abhijeetonyoutube","abhyak","absentzest","abykhovsky","actorxu","adaro","adham_fawzy","adiosabu","afgano29","aggy67","agser","airgun1","aivanov-ne","akobian-sea","akobian-stl","akshatchandra","akshayraj_kore","alefedorov","aleksa74","aleksandrovaleksei","aleksey_sorokin","alexander-evdokimov","alexanderl","alexander_donchenko","alexander_moskalenko","alexander_zubov","alexandr_predke","alexchess1062","alexchess1984","alexcolovic","alexeishirov","alexhuzman","alexonischuk","alexrustemov","alexsur1981","alexvangog","alexyermo","alex_goloshchapov","alex_stripunsky","algeriano22","allanstig","almo64","alphaodin","amintabatabaei","amir-zaibi","amirbagheri78","amirreza_p","anaconda1983","anand","andabata","andrbaryshpolets","andreikka","andrei_belozerov","andrejs_sokolov","andreystukopin","andyrodri","angelogm","anishgiri","anishonyoutube","anka-sea","annawel","anna_muzychuk","anonymous1762","anthonywirig","antipov_mikhail_al","antonshomoev","antonsmirnov","anton_demchenko","anuar_is","anurag328","aoitsukibluemoon","aradej","arambai","arcymisie","arencibia","argyllprince","ariancito1","arjunerigaisi2003","arkonada50","arm-akiba","armenianlion","arnaudovp","arseniy_nesterov","artem_ilyin","arthurkogan","art_vandelay1980","arvika","aryamabreu","aryangholami","aryantari","aryashitake","asadlivugar","aspired","assezde36","astralpulse","atalik","atomrod","attack2mateu","attackgm","attilaczebe","augustomatraga","avantage_ru","averagerecord","avetik_chessmood","avitalbor","avolodin","axves","aygehovit1992","azerichess","azerichessss","azeryahu","azgm","azikom","azzaro25","b-man","b-unit","babegroot","baby_legs","bacallao2019","bacyanide","baipi2010","baki83","bakki78","baku_boulevard","bancsoo","bankrotten","barcelona_guy","barcenilla-arz","bartoszsocko","barys1974","barzed","batica1984","batolovic","bazarov04","beca95","becerra-mia","beebucks","belabadea21","benjamin-nj","bentsfriend","berny643","besmall","bestcoacheverr","bfinegold-stl","bhat-sf","bigfish1995","bilelou","bilguunsu","billiekimbah","bilodeaua","blagid","blefer66","blindfoldkrikor","blindginger","blindlast7samurai","blindtakes","blueshark23","bluewizzard","bmw326","bobanbogosavljevic","bobbyhall222","bocah_sakit","bocharovd","bogdandeac","bonamente","bonca64","bonuspater18","boo786","boorrj","borisk62","bosiocic","brainwolf","brandonjacobson","brightthunder","brt6209","bryansmith","bubacik","bubi6","buffy7","bui2512","burbur555","bustedpack","bykhovsky-stl","byniolus","c-25","caefellion","caissa12","captainjames","carlosalbornoz","cassoulet","cayse","ccgrandmaster","cemilcan","ceraunophilmera","cerdasbrs","chabanon","chadaevnikolay","champ2005","charbonneau-ny","charlatante","checkmate_107","checky2015","checom","chefshouse","chepaschess","chernobay_artem","chessasuke","chessawp","chessbrah","chessdjw","chessdude","chesseducation4u","chessfatbear","chessfreak35","chessialist","chessking518","chessmastaflash88","chessmisic","chessmood","chessnerdstv","chessonado","chessonthemat007","chesspanda123","chessqueen","chessskool","chesstrainer2042","chesstraining77","chesswarrior7197","chessweebs","chesswolf1210","chesswy","chipsbeer","chirila-dal","chito89","chopper1905","chowman64","cipy77","classyel","clevercrab","coach_davido","cody1983","colchonero64","coldplace","colerranmorad","conquering","contora","copperbrain","courgete","crackcubano","crazyboy26","crescentmoon2411","cristhiancruzsanchez","cruel_yaro","cruise999","ctionescu","cubitas","cuencajugon","cyrilmarcelin","daanbrandenburg","daat","daggigretarsson","daika91","dalmatinac101","dancingheaven16","danieldardha2005","danielking","danielnaroditsky","daniel_fridman","danir29","danyuffa","darcylima","daro94","datfifaplaya","davidarenas1224","davidbaramidze","davidmarkosyan","david_arutinian","david_klein","davorinkuljasevic","davor_rogic","dbojkov","ddevreugt","deadeye10","dearmike","debashisdebs","deep306","defenceboy","defenceontitan","delhigm","denis_makhnyov","desconocido04","detskisad","deviatkinandrey","devikbronstein","devonlaratt","dforcen","dhoine","diamant-stl","dibyendu_barua","dinopopuslic","dinozavr69","diokletian","diwi89","djakovenko","djojua","dj_haubi","dlugy","dmitrymaximov","dogsofwar","dorian2017","dostis","dr-bassem","dr-cro","dragansolak","dragonflow","drags95","drawdenied-twitch","drblinditsky","drenchev","dretch","dropstonedp","drtancredi","drvelja","drvitman","drycounty","dr_mortimer","duanlian","dudedoel","duhless","dulemaster","dulemudule","dumbo32","durarbayli","dusanacns","dyadya81","dynamikus","e-grivas","earlgreynow","egorgeroev","ehsan_ghaemmaghami","el-marmalade","eldax64","eldur16","elefante33","elefante38","elegance_riks","elgasanov","elhelvetico","eljanov","elliotstabler","elprofesorsergio","elshan1985","eltajsafarli","eltaj_safarli","emilanka","emiliocordova","emperor87","enajer77","enki007","erenburg-phi","erichansen","erikblomqvist","ermito2020","erwinlami","etoilegeniale","etserga","eugeneperelshteyn","evandro_barbosa","evgchess5","evgeniy_88","evgeny81","evgenypigusov","evgenyromanov","evgenysharapov","evgenyt","excellent1st","exoticprincess","fabianocaruana","fablibi","fairchess_on_youtube","fandorine","faqade","farout1364","farrukh_amonatov","fartobus","fatupss","faustregel","fcchelsea14","federtiu","fedoseevvladimir","feliztigriz","feuerwehrmannsam","fierhasnopieces","fighterman91","filippov_anton","firegrizzly","firehand33","fireheart92","firouzja2003","fishbein-nj","fivetrick","floatypotato","florianhandke","flycont","fodorpoti","foewa98","formerprodigy","fosti19","frankieyale","frolyanov_d","frostnova","ftacnikl","ftorodent","fyall777","g3god","gabix_94","gabrielian_artur","gabuzyan_chessmood","gaguna","gaizca","gajuchess","gakashchess","garcho08","gareev-sea","garrykasparov","gasconchess-youtube","gavrikov","gelashvili-ny","geller_jakov","geminiboy","gen-gutman","genghis_k","genna1943","georgegiorgadze","georgescu_tiberiu","georgmeier","german-2826","gevorg_harutjunyan","ggg","gguseinov","ghandeevam2003","ghertneck","giantslayer83","gigaquparadze","gilmil","ginger_gm","giorgim-bal","givesalltheflow","glek_igor","gliglu","gm-andreyorlov","gmakobianstl","gmalex1971","gmalmeida","gmalsayed","gmantic","gmarunchess","gmashley","gmasterkiller","gmaxel23","gmazapata","gmbartek","gmbellicose","gmbenjaminbok","gmbenjaminfinegold","gmcarlosaobregon","gmcheparinov","gmchessrob","gmcorrales","gmcristhian","gmcyborek","gmdrh","gmedmundo","gmg","gmgamil","gmharikrishna","gmhellers","gmhess","gmhikaruontwitch","gmianrogers","gmizeta","gmjacobaagaard","gmjankovic","gmjlh","gmjoel","gmjoey1","gmjuliogranda","gmkomarov","gmkrikor","gmlazarobruzon","gmmarcelkanarek","gmmarcindziuba","gmmatamoros","gmmelik","gmmickeyadams","gmmikhailkazakov","gmmitkov","gmmoranda","gmmoskalenko","gmnakamuracyborg","gmneiksans","gmneiksans-bots","gmnickpert","gmoratovsky","gmpacman","gmpanno","gmpeter008","gmpontuscarlsson","gmrafaelleitao","gmreniergonzalez","gmsakk","gmsergiobarrientos","gmsrinath","gmstefanova","gmszabo","gmtalks_youtube","gmtamaz","gmtazbir","gmtodorov","gmtopmoves","gmvaleduser","gmvallejo","gmvar","gmvladimir_petkov","gmvladko","gmwso","gmyarick","gmyaz","gmzaven","gm_aag","gm_andrei_murariu","gm_barcenilla","gm_batchuluun","gm_buhmann","gm_crest","gm_d85","gm_darwinlaylo","gm_dmitrij","gm_donatello","gm_gonzalezgarcia","gm_huschenbeth","gm_igor_smirnov","gm_levan_pantsulaia","gm_mouse_sleep","gm_petrovich","gm_rashid","gm_robertomogranzini","gm_shahin","gm_splinter","gnowreopard","goanchesstrio","godspeed","gogieff","goingkronos","gonzalez-mia","gopalgn64","gorato","gordima","goryachkina","grafdemontekritz","grandelicious","grandmaster1369","grigorgrigorov","grischuk","groovykettle","grukjr","grzechu96","gserper","guachiney","guenplen","gukeshdommaraju","gulko-nj","gundavaa89","gurevichmikhail","gusanchutik","gutovandrey","hamisandwich","hamonde","handszar","hansontwitch","hanzo_hasashi1","harry_rakkel","harsha_bharathakoti","harutjunyan-gevorg","harutyuniantigrank","hasangatin_ramil","hedinn","heliopsis","hellmasterpiece","hercules64","hesham-a","hess-con","higescha","hikaru","hikarunakamura","hissha","hitaman","hoacin","hoangpeony","hoffentlichreichts","hoffmana26","holdenhc","holt-dal","homayoontofighi","honestgirl","horizonevent","hotshot008","hovik_hayrapetyan","howitzer14","hrant_chessmood","hristosbanikas","huanghou","hugooakland","hugospangenberg","humpy1987","hunga","hungaski-man","hustlestandard","hyxiom","ibrayevnb","ichamo","idontknowchess75","igmjeroenpiket","igorkovalenko","igor_lysyj","igrok3069","iljazaragatski","iljushin_alexey","illingworth","immatt64","imre91","incognito_knight","incrediblebubacik","indian-elephant","indianelephant5","indianlad","infernal_xam","injazzstyle","inopov","inspektor_rex","irochka83","iskusnyh","itachiuchiha999","iturrizaga","iuri_shkuro","iwanyu","izoria-man","izoria123","i_enchev","jacobrafael","jaguar_92","janosik","jansmeets","janwerle","jatakk","jayg9","jcibarra","jefferyx","jessekraai","jesspinkman","jfriedel","jguerramzllo","jhellsten","jim2600","jimlahey","jlucasvf","jmb2010","jncool68","joellautier","johansalomon","jonathantisdall","jon_speelman","joppie2","josemourinho2020","joshdaruca","joshuachick","josmito","josmito80","jospem","jpsmo","jrlok","jsprepz","jt","juancglez","juarinovich","juditpolgar","julio_becerra","jumbo","june57","justantan","justanything","justatrickstar","juwen","jvferreira","kacheishvili-ny","kaffeehaus1851","kaidanov","kaka666","kamilek84","kampkatten","kantorgergely","kaphrep","karavanela","kargan90","karl_2000","kastanieda_georgui","katerynalagno","kaydentroffchess","kedollaria","keene","keitharkell","kekelidze-con","kempsy","ketigrant","kevin_goh","keyzer-soze","khachiyan-la","khamrakulov_djurabek","khatanbaatarbazar","khaz_modan","kiborg1987","kiborg95","kilcruit","killer-kostya","kinglionv","kingloek","kingloek12345","kingofconvenience","kingpusher","kintoho","kira170","kiril1965","kirillshevchenko","klan1","klippfiskkjerringa","knightmare82","knvb","kobalia","koksik_13","koktebel22","komodochess","konavets","kondylev","koningsbaars","konservator69","kosanovicgoran","kosya4ok","koutsalogo","kouzari","kovkov","kpio91","kraai-sf","krakozia","krasimir_rusev","krikor-mekhitarian","kromax33","kruhor","krush-ny","krzyzan94","kuchma777","kuli4ik","kuybokarovtemur","kuzubovyuriy","k_a_s_t_o_r","k_grigoryan","l3on4rdo","lachesisq","ladheezwousharounm","lapitch","laskerisalive","last7samurai","lcfox","leeroy275","lenderman-ny","leon009","lestofante90","lestri","levgutman","levi70","levonaronian","liemle","like962","likemachine","lili_ani","lilleper1","littlepeasant","liviudieternisipeanu","lkaufman-bal","lmcshane","locotito77","lonelyqueen0","lonelyzeng","lordbalrog","lordillidan","lovac58","loverespectchess","lovevae","lpsupi","luckismyskill","luckyluka04","luckytiger","luiseqp","luisibarrach","lukas_111111","lukianoo","lupulescuc","lupul_cenusiu","lvaik","lyndonlistzmendonca","lyonbeast","maartensolleveld","machupichu10","maciek_92","macmolner","maestrog","maestroza","maghalashvili","magicmaster17","magnuscarlsen","maksat-94","malev212","mamedyarov_play","mamedyarov_twitch","mamey78","mammadyarov","man-chuk","mandoran","marcan2b","marcnd","marctarnold","mardakerxxx","mareanguis","margency","margiriskaunas","margvelashvili-dal","marianpetrov","mariyagm","markowskitomasz","markparagua","markusragger","martinez1985","masmos97","mastroskaki","masya1984","matenkatz","mathiaswomacka","matibar","matsenkosergey","matthias_wahls","mauriceashley","mauricioflores","maximdlugy","maximnovik","maxvavulin","maxwell1986","mayachiburdanidze","maybe00","mazetovic","medvegy","megazz","megazz66","mesgen","messiboca","mgeli","mhebden","michaelq2d5","michaelroiz","michelangelo","micheliavelli","mickey632702","micki-taryan","mihailmarin","mihaisuba","mikaelyanarman1996","mikhail646464","mikhail_antipov","mikhail_golubev","mikheil_kekelidze","mikolka1985","milanovicdan","milanzajic","milos021","milosji","mirceaparligras","mirman90","miromiljkovic","mironius","miron_sher","misapap","mishanick","mishikomchedlishvili","misi_95","mkanarek","mnikolov","molner-arz","molton","monmoransy","mornar1951","moro182","morteza_mahjoob","moskvaa","mossedivertenti","movebymove","mpcandelario","mrbean","mrkvoz","mrmotley","mrsavic77","mrtattaglia","mrvenky","mr_dynamic","msb2","msolleveld","mugzyyy","muisback26","mumbaimover64","muradore","murtas73","mvpjs31","myfitnesspal","m_godena","n4700000","naaas1","naarciisoo","naroditsky-sf","nat74","ndepinesperg","nemegejas","nemequittepas","nemofishy","nesterovsky","neurisdr","newbornnow","newtie4","newzorro","nguyenduchoa","nguyenxi","ni-hua","niaz1966","nidjatmamedov","nigeld","nigelshort","nihalsarin","nijat_a","nikame","nikolakis2014","niktlt","nitzan_steinberg","njal28","nnepenthes","norival","nothedgehog","noukii","nouma78","novendrapriasmoro","nowayjosey","nrvisakh","ntdvan12","nuidisvulko","nyzhnyk_illia","obliviate12","off-war","ohohohoo","ok97","oldbolt","oldfish64","oldweakgm","olegromanishin","oleksandr_bortnyk","olimpusmaximus","olkaa","olksuna","olomi007","olympusmons95","onemanarmy93","onischuk_v","oparingrigoriy","openyagami","oskariot","oskychess","oursemare","pablolafuente","pabloricardi","pablozarnicki","padenie_zvezd","panevezys","papullon","paralinch","parhamov","parimarjan","parsifal7","paul66666","paulfromspb","paulphoenix87","paulvelten","pavelmaletin","pavel_skatchkov","pawelczarnota","penguingm1","perelshteyn-bos","peretyatko","petardrenchev","peterheinenielsen","petrkostenko","petrvelicka","pgw-in-sf","phantom671","phoenix","piacramling","pidzsy","pittiplatsh","pkclub","platy3","playingsomechess","playmagnus","playpositional","polish_fighter3000","pollo2016","pomegranate988","pompey831","popov_ivan","potap1923","potosino1970","pouya21","pozhaluysta","predatoru","prettyprincess2002","priezvisko","prikolica74","profylax","promen1999","psakhislev","psvidler","psycho_cowboy","ptrajkovic","pvorontsov","qashashvilialexandre","quaternitychess","queenjudit","quesada-mia","rabachess","raceking","radzio1987","ragnaroek66","rakhmanov_aleksandr","ralf61","raphaei","rasmussvane","raspadsistema","ratkovic_miloje","raunaksadhwani2005","rayrobson","rd4ever","rdeux42","realpascalc","rednova1729","regular_legs","reinaldovera","relaxx87","remontada2017","renier07","resentiment18","reutik","revisor","rexterminator","rfelgaer","rheticus","rhungaski","riazantsev","riface11","rikikits","rikitin","rlh2","rnhs","roberi","robertfontaine","robert_chessmood","robinswinkels","rodalquilar","roelandpruijssers","rogapa","rogelio_barcenilla","rohde-con","rolanddeschain","romanenko-man","roman_ovetchkin","ronwhenley","rookoco","rozum_ivan","rpragchess","ruifeng","rumpel-vk","rybka1989","rz0","s2pac","sabinobrunello","sadorra-dal","sadorra_pcap_manila","sahajgrover","sahpufjunior","salem-ar","salgadochess91","samolo","sam_chessmood","sanan_sjugirov","sandromareco","sandropozo","sanitationengineer","santoblue","savelijtartakover","saxar85","saychesspl","scrapnel","sebastian","secretgm","secret_level","sedlak83","senseijulio","sergeiaza","sergey071164","sergeykarjakin","sergey_erenburg","sergey_kasparov","sergiochess83","setandgame","sethu0025","sevenstar82","severomorskij","sevian-bos","shankland","shankland-ne","shant_sargsyan","sharapovevgeny","sharpchess22","shevson","shield12","shiirav","shimanovalex","shimastream","shtembuliak","shyam","sibelephant","sigurvegari","sillygoosemonster","sipkeernst","sjandy","skzt","slackadaisacal","slipak","smirnov_pavel","smtheweirdone","smurfo","snake71","snavr","solingen2020","som2310","son_of_sultan","sourisblanche","spartakus1975","spasskypy","speedskater","spicycaterpillar","spiritofwonder","srinavasan","srmiguel99","ss003","stanislavnovikov","stanyga","starmatecc","stephendedalus83","storne89","strelec64","stripunsky-nj","stupid11","stuwdrey","sumohawk","sumopork","sundarkidambi","superblysse","superchess02","superetual","suryaganguly","susanpolgar","swapchess90","swapchesspathshala","swayamsm","swisspower96","sxsw2","sychev_klementy","szfinx11","tacticusbd","taekwondoking","tal-baron","tamirnabaty","tapuah","tarhercule","tarlev_konstantin","tartody","tashik","taxidermist","taykagm","tdf98pantani","teamchesscomes","teamglud","temiksmozg","tenismaster","terorptica","tetris4jeff","tgrade","thalaiva","thamizhan","thatsallshewrote","thecount","theexpertpatzer","thegadfly1897","thegormacle","thej11","thejoker64","theredking89","therobot72","thesilmarils","thevish","the_impost0r","thipsay","tigergenov","tigra","tigrangharamian","tigrvshlyape","timofeevar","timurgareyev","tirantes","tiredofdancing","titan013","tittanok","tiviakov","tjallkompall","tk161","tocras","tokyovice","tomaspolak74","tomskantans","topotun","tormoz","tornikesanikidze","tptagain","tradjabov","tranjminh","trankuilizer","tranminhpj","transponster","tregubovp","tribaldancer","tuksz","turkchess1905","twannibal","uandersson2000","uchihovich","ucitelot","udysseus1","ulvi95","underdogchss","unseeinghammer","untouchablez","uzbektiger1963","vaathi_coming","valger","vanina1989","vanych","vartemiev","varuzhanakobian","vasily_papin","vb84","vbhat","vegasicilia","verdenotte","veselintopalov359","vica56","viditchess","vidityt","viestur21","viih_sou","viiiagra","vincentkeymer","vincentmasuka","violord","virgo15","vishnuprasanna","vitaliybernadskiy","vitarasik","viviania","viziruk","vladdobrov","vladimirkramnik","vladimirpotkin","vladimir_2020","vladimir_zakhartsov","vladislavkovalev","vladislavtkachev","vladjianu","vmikhalevski","vojtechplat","volodja49","vorenus_lucius","vovan1991","vovanchik0991","vovkcoach","vsanduleac","vserguei","vugarrasulov","vyotov","wanderingknightly","wanghao","wasawarrior1","washuntilholes","weng_pogi","wizard456","worldwar66","wraku89","wrongking","wudileige","wyharga","xamax2000","xdps","xxysoul6","yamalchess","yannickpelletier","yardird","yifan0227","yobdc","yoredea","youman2016","youngkid","younguzbek","yqperez","yuri202062","yuriy88","yuryshulman","zabdumalik","zablotsky","zaczel","zadarchess","zanyglobal","zaur-mammadov","zaven_chessmood","zeeduin","zhigalko_sergei","zhuu96","ziachess74","zirafa1","zkid","zlatan56","zona1","zq1","zstardust","zubov_alexander","zubov_on_youtube","zubridis","zugazuando","zuraazmai","zvonokchess1996"]

with open('ccdatadownload', 'w') as f:
    for gm in tqdm(gms):
        data = requests.get(f"https://api.chess.com/pub/player/{gm}/games/2021/09")
        while data.status_code == 429:
            time.sleep(5)
            data = requests.get(f"https://api.chess.com/pub/player/{gm}/games/2021/09")
        f.write(data.text)
        f.write("\n")
        time.sleep(1)
'''

def timeControlToClass(string):
    if string == "-" or "/" in string:
        return "daily" # use chess.com names for consistency
    if "+" not in string:
        (start, inc) = (int(string), 0)
    else:
        (start, inc) = map(int, string.split('+'))
    total = start + (40*inc)
    if total <= 29:
        return "ultraBullet"
    if total <= 179:
        return "bullet"
    if total <= 479:
        return "blitz"
    if total <= 1499:
        return "rapid"
    return "classical"

gamedata = []
with open('ccdatadownload', 'r') as f:
    for line in f:
        games = json.loads(line)
        for game in games['games']:
            gamedata.append({k: v for k, v in game.items() if k in {'url', 'time_control', 'end_time'}})

for game in gamedata:
    game['time_class'] = timeControlToClass(game['time_control'])

df = pd.DataFrame.from_dict(gamedata)
df.to_csv('ccdataanalysed')

